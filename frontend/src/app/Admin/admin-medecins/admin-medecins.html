<div class="dashboard-container">
  <!-- Background Effects -->
  <div class="dashboard-background">
    <div class="floating-elements">
      <div class="floating-icon"><i class="fas fa-user-md"></i></div>
      <div class="floating-icon"><i class="fas fa-stethoscope"></i></div>
      <div class="floating-icon"><i class="fas fa-heartbeat"></i></div>
      <div class="floating-icon"><i class="fas fa-clipboard-check"></i></div>
      <div class="floating-icon"><i class="fas fa-hospital"></i></div>
      <div class="floating-icon"><i class="fas fa-prescription"></i></div>
    </div>
    <div class="pulse-effect"></div>
  </div>

  <div class="dashboard-content">
    <!-- Welcome Section -->
    <div class="welcome-section">
      <div class="welcome-content">
        <h1><i class="fas fa-user-md"></i> Gestion des Médecins</h1>
        <p>Gérez les médecins de votre cabinet : <strong>{{ adminCabinetNom }}</strong></p>
        <div class="current-time">
          <i class="fas fa-calendar-alt"></i>
          {{ currentDate }} • {{ filteredMedecins.length }} médecins dans votre cabinet
        </div>
        <div class="admin-info" style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem; font-size: 0.9rem; color: #a78bfa;">
          <i class="fas fa-user-shield"></i>
          Administrateur connecté : Cabinet {{ adminCabinetNom }}
        </div>
      </div>
      <div class="quick-actions-header">
        <button class="action-btn secondary" (click)="resetFilters()">
          <i class="fas fa-filter"></i> Réinitialiser les filtres
        </button>
        <button class="action-btn primary" (click)="showAddForm = !showAddForm">
          <i class="fas fa-plus"></i> {{ showAddForm ? 'Annuler' : 'Ajouter un médecin' }}
        </button>
      </div>
    </div>

    <!-- Statistics Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #a78bfa, #7c3aed);">
          <i class="fas fa-user-md"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ totalMedecins }}</div>
          <div class="stat-label">Médecins dans votre cabinet</div>
          <div class="stat-trend positive">
            <i class="fas fa-hospital"></i> {{ adminCabinetNom }}
          </div>
        </div>
        <div class="stat-sparkline"></div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #10B981, #059669);">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ medecinsActifs }}</div>
          <div class="stat-label">Médecins actifs</div>
          <div class="stat-trend positive">
            <i class="fas fa-arrow-up"></i> {{ (medecinsActifs / totalMedecins * 100).toFixed(1) }}%
          </div>
        </div>
        <div class="stat-sparkline"></div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #F59E0B, #D97706);">
          <i class="fas fa-umbrella-beach"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ medecinsEnConge }}</div>
          <div class="stat-label">En congé</div>
          <div class="stat-trend">
            <i class="fas fa-minus"></i> {{ (medecinsEnConge / totalMedecins * 100).toFixed(1) }}%
          </div>
        </div>
        <div class="stat-sparkline"></div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #EF4444, #DC2626);">
          <i class="fas fa-user-slash"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ medecinsInactifs }}</div>
          <div class="stat-label">Médecins inactifs</div>
          <div class="stat-trend negative">
            <i class="fas fa-arrow-down"></i> {{ (medecinsInactifs / totalMedecins * 100).toFixed(1) }}%
          </div>
        </div>
        <div class="stat-sparkline"></div>
      </div>
    </div>

    <!-- Formulaire d'ajout de médecin -->
    <div *ngIf="showAddForm" class="cabinet-form-section">
      <div class="form-header">
        <h2><i class="fas fa-user-plus"></i> Ajouter un nouveau médecin</h2>
        <button class="btn-close-form" (click)="showAddForm = false">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form (submit)="ajouterMedecin(); $event.preventDefault()">
        <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
          <div class="form-group">
            <label><i class="fas fa-user"></i> Nom</label>
            <input type="text" class="form-control" [(ngModel)]="newMedecin.nom" name="nom" required placeholder="Entrez le nom">
          </div>
          <div class="form-group">
            <label><i class="fas fa-user"></i> Prénom</label>
            <input type="text" class="form-control" [(ngModel)]="newMedecin.prenom" name="prenom" required placeholder="Entrez le prénom">
          </div>
        </div>

        <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
          <div class="form-group">
            <label><i class="fas fa-graduation-cap"></i> Spécialité</label>
            <select class="form-control" [(ngModel)]="newMedecin.specialite" name="specialite" required>
              <option value="">Sélectionnez une spécialité</option>
              <option *ngFor="let spec of specialites" [value]="spec">{{ spec }}</option>
            </select>
          </div>
          <div class="form-group">
            <label><i class="fas fa-building"></i> Cabinet</label>
            <input type="text" class="form-control" [value]="adminCabinetNom" readonly disabled>
            <input type="hidden" [(ngModel)]="newMedecin.cabinetId" name="cabinetId" [value]="adminCabinetId">
            <div class="cabinet-info" style="font-size: 0.85rem; color: #a78bfa; margin-top: 0.25rem;">
              <i class="fas fa-info-circle"></i> Le médecin sera ajouté à votre cabinet
            </div>
          </div>
        </div>

        <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
          <div class="form-group">
            <label><i class="fas fa-envelope"></i> Email</label>
            <input type="email" class="form-control" [(ngModel)]="newMedecin.email" name="email" required placeholder="email@cabinet.fr">
          </div>
          <div class="form-group">
            <label><i class="fas fa-phone"></i> Téléphone</label>
            <input type="tel" class="form-control" [(ngModel)]="newMedecin.telephone" name="telephone" required placeholder="01 23 45 67 89">
          </div>
        </div>

        <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
          <div class="form-group">
            <label><i class="fas fa-id-card"></i> Matricule</label>
            <input type="text" class="form-control" [(ngModel)]="newMedecin.matricule" name="matricule" required placeholder="MED123456">
          </div>
          <div class="form-group">
            <label><i class="fas fa-calendar"></i> Date d'embauche</label>
            <input type="date" class="form-control" [(ngModel)]="newMedecin.dateEmbauche" name="dateEmbauche" required>
          </div>
        </div>

        <div class="form-group" style="margin-bottom: 1.5rem;">
          <label><i class="fas fa-chart-line"></i> Statut</label>
          <select class="form-control" [(ngModel)]="newMedecin.statut" name="statut" required>
            <option value="actif">Actif</option>
            <option value="inactif">Inactif</option>
            <option value="congé">En congé</option>
          </select>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="showAddForm = false">
            <i class="fas fa-times"></i> Annuler
          </button>
          <button type="submit" class="btn-submit" [disabled]="!validerFormulaire()">
            <i class="fas fa-save"></i> Ajouter le médecin
          </button>
        </div>
      </form>
    </div>

    <!-- Section Recherche et Filtres -->
    <div class="widget-section mb-4">
      <div class="section-header">
        <h2><i class="fas fa-search"></i> Recherche et Filtrage</h2>
        <button class="action-btn secondary" (click)="resetFilters()" style="padding: 0.5rem 1rem;">
          <i class="fas fa-sync-alt"></i> Réinitialiser
        </button>
      </div>
      
      <div class="search-filter-section">
        <!-- Barre de recherche principale -->
        <div class="search-box">
          <div class="search-icon">
            <i class="fas fa-search"></i>
          </div>
          <input type="text" 
                 class="search-input" 
                 [(ngModel)]="searchQuery" 
                 placeholder="Rechercher un médecin par nom, prénom, spécialité ou matricule...">
          <button class="search-clear" (click)="searchQuery = ''" *ngIf="searchQuery">
            <i class="fas fa-times"></i>
          </button>
        </div>
        
        <!-- Filtres rapides -->
        <div class="filter-grid">
          <!-- Cabinet (désactivé et pré-sélectionné) -->
          <div class="filter-group">
            <label><i class="fas fa-hospital"></i> Cabinet</label>
            <select class="filter-select" [(ngModel)]="selectedCabinet" [disabled]="true">
              <option [value]="adminCabinetId">{{ adminCabinetNom }}</option>
            </select>
            <div class="cabinet-info" style="font-size: 0.85rem; color: #a78bfa; margin-top: 0.25rem;">
              <i class="fas fa-info-circle"></i> Cabinet de l'administrateur
            </div>
          </div>
          
          <div class="filter-group">
            <label><i class="fas fa-graduation-cap"></i> Spécialité</label>
            <select class="filter-select" [(ngModel)]="selectedSpecialite">
              <option value="tous">Toutes spécialités</option>
              <option *ngFor="let spec of specialites" [value]="spec">{{ spec }}</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label><i class="fas fa-chart-line"></i> Statut</label>
            <select class="filter-select" [(ngModel)]="selectedStatut">
              <option value="tous">Tous statuts</option>
              <option value="actif">Actif</option>
              <option value="inactif">Inactif</option>
              <option value="congé">En congé</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label><i class="fas fa-sort"></i> Trier par</label>
            <select class="filter-select" [(ngModel)]="sortBy" (change)="toggleSort(sortBy)">
              <option value="nom">Nom</option>
              <option value="dateEmbauche">Date d'embauche</option>
              <option value="specialite">Spécialité</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Tableau des médecins -->
    <div class="widget-section">
      <div class="section-header">
        <h2><i class="fas fa-list"></i> Liste des Médecins de votre cabinet ({{ filteredMedecins.length }})</h2>
        <div class="table-actions">
          <button class="action-btn secondary" (click)="exportToExcel()">
            <i class="fas fa-file-export"></i> Exporter
          </button>
          <button class="action-btn secondary" (click)="printList()">
            <i class="fas fa-print"></i> Imprimer
          </button>
        </div>
      </div>
      
      <div class="table-container">
        <table class="medecins-table">
          <thead>
            <tr>
              <th>
                <div class="table-header">
                  <span>Médecin</span>
                  <button class="sort-btn" (click)="toggleSort('nom')">
                    <i class="fas fa-sort"></i>
                  </button>
                </div>
              </th>
              <th>Spécialité</th>
              <th>Cabinet</th>
              <th>Coordonnées</th>
              <th>Matricule</th>
              <th>Date Embauche</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let medecin of filteredMedecins">
              <td>
                <div class="medecin-info">
                  <div class="medecin-avatar" [style.background]="getStatutBackgroundColor(medecin.statut)">
                    <span class="avatar-text">
                      {{ medecin.prenom[0] }}{{ medecin.nom[0] }}
                    </span>
                    <div class="status-dot" [style.background]="getStatutColor(medecin.statut)"></div>
                  </div>
                  <div class="medecin-details">
                    <div class="medecin-name">Dr. {{ medecin.prenom }} {{ medecin.nom }}</div>
                    <div class="medecin-email">{{ medecin.email }}</div>
                  </div>
                </div>
              </td>
              <td>
                <span class="specialite-badge">{{ medecin.specialite }}</span>
              </td>
              <td>
                <div class="cabinet-info">
                  <i class="fas fa-hospital"></i>
                  <span>{{ adminCabinetNom }}</span>
                </div>
              </td>
              <td>
                <div class="contact-info">
                  <div><i class="fas fa-phone"></i> {{ medecin.telephone }}</div>
                  <div><i class="fas fa-envelope"></i> {{ medecin.email }}</div>
                </div>
              </td>
              <td>
                <span class="matricule">{{ medecin.matricule }}</span>
              </td>
              <td>
                {{ formatDate(medecin.dateEmbauche) }}
              </td>
              <td>
                <span class="status-badge" [ngClass]="'status-' + medecin.statut">
                  {{ medecin.statut === 'actif' ? 'Actif' : medecin.statut === 'inactif' ? 'Inactif' : 'En congé' }}
                </span>
              </td>
              <td>
                <div class="action-buttons">
                  <button class="btn-action edit" (click)="editMedecin(medecin)" title="Modifier">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn-action status" (click)="toggleStatut(medecin)" [title]="'Changer le statut (' + medecin.statut + ')'">
                    <i class="fas fa-exchange-alt"></i>
                  </button>
                  <button class="btn-action delete" (click)="supprimerMedecin(medecin.idMedecin)" title="Supprimer">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        
        <div *ngIf="filteredMedecins.length === 0" class="empty-table">
          <div class="empty-icon">
            <i class="fas fa-user-md"></i>
          </div>
          <h3>Aucun médecin trouvé</h3>
          <p>Aucun médecin ne correspond à vos critères de recherche dans votre cabinet.</p>
          <button class="empty-action" (click)="resetFilters()">
            <i class="fas fa-sync-alt"></i> Réinitialiser les filtres
          </button>
          <button class="empty-action" (click)="showAddForm = true" style="margin-top: 0.5rem; background: linear-gradient(135deg, #10B981, #059669);">
            <i class="fas fa-plus"></i> Ajouter un médecin
          </button>
        </div>
      </div>
      
      <!-- Pagination -->
      <div class="pagination" *ngIf="filteredMedecins.length > 0">
        <div class="pagination-info">
          Affichage de 1 à {{ filteredMedecins.length }} sur {{ totalMedecins }} médecins
        </div>
        <div class="pagination-controls">
          <button class="pagination-btn" [disabled]="true">
            <i class="fas fa-chevron-left"></i>
          </button>
          <span class="pagination-page">1</span>
          <button class="pagination-btn" [disabled]="true">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Section des spécialités -->
    <div class="widget-section">
      <div class="section-header">
        <h2><i class="fas fa-chart-pie"></i> Répartition par spécialité dans votre cabinet</h2>
      </div>
      
      <div class="specialites-grid">
        <div *ngFor="let spec of specialites" class="specialite-card">
          <div class="specialite-header">
            <div class="specialite-icon">
              <i class="fas fa-stethoscope"></i>
            </div>
            <div class="specialite-info">
              <div class="specialite-name">{{ spec }}</div>
              <div class="specialite-count">{{ getMedecinsCountBySpecialite(spec) }} médecins</div>
            </div>
          </div>
          <div class="specialite-progress">
            <div class="progress-bar" [style.width]="(getMedecinsCountBySpecialite(spec) / totalMedecins * 100) + '%'"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>