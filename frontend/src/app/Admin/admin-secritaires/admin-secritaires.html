<div class="dashboard-container">
  <div class="dashboard-background">
    <div class="floating-elements">
      <div class="floating-icon"><i class="fas fa-user-md"></i></div>
      <div class="floating-icon"><i class="fas fa-stethoscope"></i></div>
      <div class="floating-icon"><i class="fas fa-heartbeat"></i></div>
      <div class="floating-icon"><i class="fas fa-pills"></i></div>
      <div class="floating-icon"><i class="fas fa-clipboard-list"></i></div>
      <div class="floating-icon"><i class="fas fa-calendar-check"></i></div>
    </div>
    <div class="pulse-effect"></div>
  </div>

  <div class="dashboard-content">
    <!-- Section Bienvenue -->
    <div class="welcome-section">
      <div class="welcome-content">
        <h1><i class="fas fa-user-nurse me-2"></i> Gestion des Secrétaires</h1>
        <p>Gérez les secrétaires de votre cabinet : <strong>{{ adminCabinetNom }}</strong></p>
        <div class="current-time">
          <i class="fas fa-clock"></i>
          <span>{{ stats.total }} secrétaire(s) dans votre cabinet | {{ stats.actifs }} actif(s)</span>
        </div>
        <div class="admin-info" style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem; font-size: 0.9rem; color: #a78bfa;">
          <i class="fas fa-user-shield"></i>
          Administrateur connecté : Cabinet {{ adminCabinetNom }}
        </div>
      </div>
      <div class="quick-actions-header">
        <button class="action-btn secondary" (click)="resetFilters()">
          <i class="fas fa-filter"></i>
          <span>Réinitialiser</span>
        </button>
        <button class="action-btn primary" (click)="showAddForm = !showAddForm">
          <i class="fas fa-plus"></i>
          <span>{{ showAddForm ? 'Annuler' : 'Ajouter une secrétaire' }}</span>
        </button>
        <button class="action-btn secondary" (click)="genererRapport()">
          <i class="fas fa-file-export"></i>
          <span>Rapport</span>
        </button>
      </div>
    </div>

    <!-- Formulaire d'ajout de secrétaire -->
    <div *ngIf="showAddForm" class="cabinet-form-section">
      <div class="form-header">
        <h2><i class="fas fa-user-plus"></i> Ajouter une nouvelle secrétaire</h2>
        <button class="btn-close-form" (click)="showAddForm = false">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form (submit)="ajouterSecretaire(); $event.preventDefault()">
        <div class="form-row">
          <div class="form-group">
            <label><i class="fas fa-user"></i> Nom</label>
            <input type="text" class="form-control" [(ngModel)]="newSecretaire.nom" name="nom" required placeholder="Entrez le nom">
          </div>
          <div class="form-group">
            <label><i class="fas fa-user"></i> Prénom</label>
            <input type="text" class="form-control" [(ngModel)]="newSecretaire.prenom" name="prenom" required placeholder="Entrez le prénom">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label><i class="fas fa-graduation-cap"></i> Spécialité</label>
            <select class="form-control" [(ngModel)]="newSecretaire.specialite" name="specialite" required>
              <option value="">Sélectionnez une spécialité</option>
              <option *ngFor="let spec of specialites" [value]="spec">{{ spec }}</option>
            </select>
          </div>
          <div class="form-group">
            <label><i class="fas fa-building"></i> Cabinet</label>
            <input type="text" class="form-control" [value]="adminCabinetNom" readonly disabled>
            <input type="hidden" [(ngModel)]="newSecretaire.cabinetId" name="cabinetId" [value]="adminCabinetId">
            <div class="cabinet-info" style="font-size: 0.85rem; color: #a78bfa; margin-top: 0.25rem;">
              <i class="fas fa-info-circle"></i> La secrétaire sera ajoutée à votre cabinet
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label><i class="fas fa-envelope"></i> Email</label>
            <input type="email" class="form-control" [(ngModel)]="newSecretaire.email" name="email" required placeholder="email@cabinet.fr">
          </div>
          <div class="form-group">
            <label><i class="fas fa-phone"></i> Téléphone</label>
            <input type="tel" class="form-control" [(ngModel)]="newSecretaire.telephone" name="telephone" required placeholder="01 23 45 67 89">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label><i class="fas fa-calendar"></i> Date d'embauche</label>
            <input type="date" class="form-control" [(ngModel)]="newSecretaire.dateEmbauche" name="dateEmbauche" required>
          </div>
          <div class="form-group">
            <label><i class="fas fa-chart-line"></i> Statut</label>
            <select class="form-control" [(ngModel)]="newSecretaire.status" name="status" required>
              <option value="actif">Actif</option>
              <option value="inactif">Inactif</option>
              <option value="congé">En congé</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label><i class="fas fa-calendar-check"></i> Rendez-vous assignés</label>
            <input type="number" class="form-control" [(ngModel)]="newSecretaire.rendezVousAssignes" name="rendezVousAssignes" required min="0" placeholder="0">
          </div>
          <div class="form-group">
            <label><i class="fas fa-clock"></i> Heures de travail/semaine</label>
            <input type="number" class="form-control" [(ngModel)]="newSecretaire.heuresTravail" name="heuresTravail" required min="0" max="60" placeholder="35">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label><i class="fas fa-chart-bar"></i> Performance (%)</label>
            <input type="number" class="form-control" [(ngModel)]="newSecretaire.performance" name="performance" required min="0" max="100" placeholder="85">
          </div>
          <div class="form-group">
            <label><i class="fas fa-palette"></i> Couleur avatar</label>
            <select class="form-control" [(ngModel)]="newSecretaire.avatarColor" name="avatarColor">
              <option value="#3B82F6">Bleu</option>
              <option value="#8B5CF6">Violet</option>
              <option value="#10B981">Vert</option>
              <option value="#F59E0B">Orange</option>
              <option value="#EC4899">Rose</option>
              <option value="#0EA5E9">Bleu clair</option>
              <option value="#F43F5E">Rouge</option>
            </select>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="showAddForm = false">
            <i class="fas fa-times"></i> Annuler
          </button>
          <button type="submit" class="btn-submit" [disabled]="!validerFormulaire()">
            <i class="fas fa-save"></i> Ajouter la secrétaire
          </button>
        </div>
      </form>
    </div>

    <!-- Statistiques -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon" style="background: rgba(59, 130, 246, 0.2);">
          <i class="fas fa-user-nurse" style="color: #3B82F6;"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.total }}</div>
          <div class="stat-label">Secrétaires dans votre cabinet</div>
          <div class="stat-trend positive">
            <i class="fas fa-hospital"></i>
            <span>{{ adminCabinetNom }}</span>
          </div>
        </div>
        <div class="stat-sparkline"></div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background: rgba(16, 185, 129, 0.2);">
          <i class="fas fa-user-check" style="color: #10B981;"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.actifs }}</div>
          <div class="stat-label">Secrétaires actifs</div>
          <div class="stat-trend positive">
            <i class="fas fa-arrow-up"></i>
            <span>{{ (stats.actifs / stats.total * 100).toFixed(1) }}%</span>
          </div>
        </div>
        <div class="stat-sparkline"></div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background: rgba(245, 158, 11, 0.2);">
          <i class="fas fa-chart-line" style="color: #F59E0B;"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.performanceMoyenne }}%</div>
          <div class="stat-label">Performance moyenne</div>
          <div class="stat-trend positive">
            <i class="fas fa-arrow-up"></i>
            <span>Performance globale</span>
          </div>
        </div>
        <div class="stat-sparkline"></div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background: rgba(139, 92, 246, 0.2);">
          <i class="fas fa-calendar-alt" style="color: #8B5CF6;"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.totalRendezVous }}</div>
          <div class="stat-label">Rendez-vous gérés</div>
          <div class="stat-trend positive">
            <i class="fas fa-arrow-up"></i>
            <span>Ce mois</span>
          </div>
        </div>
        <div class="stat-sparkline"></div>
      </div>
    </div>

    <!-- Filtrage et Recherche -->
    <div class="search-filter-section">
      <div class="search-box">
        <i class="fas fa-search search-icon"></i>
        <input 
          type="text" 
          class="search-input" 
          placeholder="Rechercher un secrétaire..." 
          [(ngModel)]="searchTerm"
          (input)="currentPage = 1"
        >
        <button class="search-clear" (click)="searchTerm = ''; currentPage = 1" *ngIf="searchTerm">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="filter-grid">
        <div class="filter-group">
          <label><i class="fas fa-filter"></i> Statut</label>
          <select class="filter-select" [(ngModel)]="statusFilter" (change)="currentPage = 1">
            <option value="all">Tous les statuts</option>
            <option value="actif">Actif</option>
            <option value="inactif">Inactif</option>
            <option value="congé">En congé</option>
          </select>
        </div>

        <!-- Cabinet désactivé et pré-sélectionné avec celui de l'admin -->
        <div class="filter-group">
          <label><i class="fas fa-building"></i> Cabinet</label>
          <select class="filter-select" [disabled]="true">
            <option>{{ adminCabinetNom }}</option>
          </select>
          <div class="cabinet-info" style="font-size: 0.85rem; color: #a78bfa; margin-top: 0.25rem;">
            <i class="fas fa-info-circle"></i> Cabinet de l'administrateur
          </div>
        </div>

        <div class="filter-group">
          <label><i class="fas fa-star"></i> Spécialité</label>
          <select class="filter-select" [(ngModel)]="specialiteFilter" (change)="currentPage = 1">
            <option value="all">Toutes les spécialités</option>
            <option *ngFor="let specialite of specialites" [value]="specialite">{{ specialite }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label><i class="fas fa-sort"></i> Trier par</label>
          <select class="filter-select" [(ngModel)]="sortColumn" (change)="currentPage = 1">
            <option value="nom">Nom</option>
            <option value="prenom">Prénom</option>
            <option value="dateEmbauche">Date d'embauche</option>
            <option value="performance">Performance</option>
            <option value="rendezVousAssignes">Rendez-vous</option>
          </select>
        </div>
      </div>

      <div class="flex justify-between items-center mt-4">
        <div class="text-sm text-gray-400">
          {{ filteredSecretaires.length }} secrétaire(s) trouvé(s) dans votre cabinet
        </div>
        <button class="action-btn secondary" (click)="resetFilters()">
          <i class="fas fa-redo"></i>
          <span>Réinitialiser</span>
        </button>
      </div>
    </div>

    <!-- Liste des Secrétaires -->
    <div class="table-container">
      <div *ngIf="filteredSecretaires.length === 0" class="empty-state">
        <div class="empty-icon">
          <i class="fas fa-user-slash"></i>
        </div>
        <h3 class="empty-title">Aucun secrétaire trouvé</h3>
        <p class="empty-description">
          Aucun secrétaire ne correspond aux critères de recherche dans votre cabinet.
        </p>
        <button class="empty-action" (click)="resetFilters()">
          <i class="fas fa-redo"></i>
          Réinitialiser les filtres
        </button>
        <button class="empty-action" (click)="showAddForm = true" style="margin-top: 0.5rem; background: linear-gradient(135deg, #10B981, #059669);">
          <i class="fas fa-plus"></i>
          Ajouter une secrétaire
        </button>
      </div>

      <table class="medecins-table" *ngIf="filteredSecretaires.length > 0">
        <thead>
          <tr>
            <th>
              <div class="table-header">
                <span>Secrétaire</span>
                <button class="sort-btn" (click)="sort('nom')">
                  <i class="fas fa-sort" *ngIf="sortColumn !== 'nom'"></i>
                  <i class="fas fa-sort-up" *ngIf="sortColumn === 'nom' && sortDirection === 'asc'"></i>
                  <i class="fas fa-sort-down" *ngIf="sortColumn === 'nom' && sortDirection === 'desc'"></i>
                </button>
              </div>
            </th>
            <th>Contact</th>
            <th>
              <div class="table-header">
                <span>Cabinet</span>
              </div>
            </th>
            <th>Performance</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let secretaire of paginatedSecretaires">
            <td data-label="Secrétaire">
              <div class="medecin-info">
                <div class="medecin-avatar" [style.background]="secretaire.avatarColor">
                  <span class="avatar-text">{{ getInitiales(secretaire.nom, secretaire.prenom) }}</span>
                  <div class="status-dot" [ngClass]="{
                    'online': secretaire.status === 'actif',
                    'warning': secretaire.status === 'congé',
                    'offline': secretaire.status === 'inactif'
                  }"></div>
                </div>
                <div class="medecin-details">
                  <div class="medecin-name">{{ secretaire.prenom }} {{ secretaire.nom }}</div>
                  <div class="medecin-email">{{ secretaire.email }}</div>
                  <div class="text-xs text-gray-400 mt-1">
                    <i class="fas fa-briefcase me-1"></i>
                    {{ secretaire.specialite }}
                  </div>
                </div>
              </div>
            </td>
            <td data-label="Contact">
              <div class="contact-info">
                <div><i class="fas fa-phone"></i> {{ secretaire.telephone }}</div>
                <div><i class="fas fa-calendar-alt"></i> {{ getDateFormatee(secretaire.dateEmbauche) }}</div>
                <div><i class="fas fa-history"></i> {{ getAnciennete(secretaire.dateEmbauche) }} an(s)</div>
              </div>
            </td>
            <td data-label="Cabinet">
              <div class="cabinet-info">
                <i class="fas fa-building"></i>
                {{ adminCabinetNom }}
              </div>
            </td>
            <td data-label="Performance">
              <div class="flex items-center gap-2">
                <div class="w-24 bg-gray-700 rounded-full h-2">
                  <div class="h-full rounded-full" 
                       [style.width]="secretaire.performance + '%'"
                       [ngClass]="{
                         'bg-green-500': secretaire.performance >= 90,
                         'bg-yellow-500': secretaire.performance >= 75 && secretaire.performance < 90,
                         'bg-red-500': secretaire.performance < 75
                       }">
                  </div>
                </div>
                <span class="font-semibold">{{ secretaire.performance }}%</span>
              </div>
              <div class="text-xs text-gray-400 mt-1">
                {{ secretaire.rendezVousAssignes }} RDV | {{ secretaire.heuresTravail }}h/sem
              </div>
            </td>
            <td data-label="Statut">
              <span class="status-badge" [ngClass]="{
                'status-actif': secretaire.status === 'actif',
                'status-inactif': secretaire.status === 'inactif',
                'status-congé': secretaire.status === 'congé'
              }">
                {{ secretaire.status === 'actif' ? 'Actif' : 
                   secretaire.status === 'inactif' ? 'Inactif' : 'En congé' }}
              </span>
            </td>
            <td data-label="Actions">
              <div class="action-buttons">
                <button class="btn-action edit" (click)="editSecretaire(secretaire)" title="Modifier">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn-action status" (click)="toggleStatus(secretaire)" 
                        [title]="secretaire.status === 'actif' ? 'Désactiver' : 'Activer'">
                  <i class="fas" [ngClass]="secretaire.status === 'actif' ? 'fa-user-slash' : 'fa-user-check'"></i>
                </button>
                <button class="btn-action delete" (click)="deleteSecretaire(secretaire)" title="Supprimer">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination -->
      <div class="pagination" *ngIf="filteredSecretaires.length > 0">
        <div class="pagination-info">
          Affichage de {{ (currentPage - 1) * itemsPerPage + 1 }} à 
          {{ getMin(currentPage, itemsPerPage, filteredSecretaires) }} 
          sur {{ filteredSecretaires.length }} secrétaire(s) dans votre cabinet
        </div>
        <div class="pagination-controls">
          <button class="pagination-btn" (click)="previousPage()" [disabled]="currentPage === 1">
            <i class="fas fa-chevron-left"></i>
          </button>
          
          <div class="flex gap-1">
            <button class="pagination-btn" 
                    *ngFor="let page of [].constructor(totalPages); let i = index" 
                    (click)="goToPage(i + 1)"
                    [class.bg-purple-600]="currentPage === i + 1">
              {{ i + 1 }}
            </button>
          </div>
          
          <button class="pagination-btn" (click)="nextPage()" [disabled]="currentPage === totalPages">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Grille des Spécialités -->
    <div class="widget-section mt-6">
      <div class="section-header">
        <h2><i class="fas fa-star"></i> Répartition par Spécialité dans votre cabinet</h2>
      </div>
      <div class="specialites-grid">
        <div class="specialite-card" *ngFor="let specialite of specialiteRepartition">
          <div class="specialite-header">
            <div class="specialite-icon">
              <i class="fas" [ngClass]="{
                'fa-file-alt': specialite.nom.includes('Administratif'),
                'fa-users': specialite.nom.includes('Accueil'),
                'fa-calendar': specialite.nom.includes('Planification')
              }"></i>
            </div>
            <div class="specialite-info">
              <div class="specialite-name">{{ specialite.nom }}</div>
              <div class="specialite-count">
                {{ specialite.count }} secrétaire(s)
              </div>
            </div>
          </div>
          <div class="specialite-progress">
            <div class="progress-bar" [style.width]="specialite.percentage + '%'"></div>
          </div>
        </div>
      </div>
    </div> 
  </div>
</div>